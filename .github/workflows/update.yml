name: Update Weather Image

on:
  schedule:
    - cron: '0 * * * *' # Run every hour
  workflow_dispatch:      # Allows manual trigger

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Download and Process Image
        run: |
          # 1. Install ImageMagick (Standard Linux tool for image editing)
          sudo apt-get update
          sudo apt-get install -y imagemagick

          # 2. Download directly from wttr.in (It generates the PNG for us)
          # Mumbai.png = The location
          # ?0 = Current weather only (Removes complex forecast text)
          # ?Q = Quiet version (Cleaner)
          curl "https://wttr.in/Mumbai.png?0Q" --output weather-orig.png

          # 3. Convert to Kindle Grayscale (Critical for 5.3.3)
          # This forces the image into the 8-bit format your screen expects
          convert weather-orig.png -colorspace Gray -depth 8 -type Grayscale weather-gray.png

      - name: Save Image to GitHub
        run: |
          git config --global user.name 'GitHub Action'
          git config --global user.email 'action@github.com'
          git add weather-gray.png
          git commit -m "Update weather" || echo "No changes"
          git push
