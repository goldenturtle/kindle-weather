<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Kindle Weather Hindi</title>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; padding: 18px; background: #fff; color: #000; font-family: "Arial", sans-serif; width: 600px; height: 800px; overflow: hidden; }
        .wrap { width: 100%; }
        
        /* Top Bar */
        .topbar { border-bottom: 3px solid #000; padding-bottom: 10px; margin-bottom: 12px; overflow: hidden; }
        .city { font-size: 36px; font-weight: 900; line-height: 1.1; float: left; width: 70%; }
        .clock { float: right; font-size: 20px; font-weight: 900; margin-top: 10px; }

        /* Main Temp Row */
        .bigrow { overflow: hidden; margin-top: 10px; margin-bottom: 20px; }
        .tempblock { float: left; margin-right: 18px; }
        .temp { font-size: 110px; font-weight: 900; line-height: 0.95; }
        .condblock { overflow: hidden; padding-top: 10px; }
        .cond { font-size: 32px; font-weight: 900; display: block; margin-bottom: 5px; }
        .aqi { display: inline-block; padding: 4px 10px; border: 2px solid #000; border-radius: 20px; font-weight: bold; font-size: 16px; margin-right: 10px;}
        .feels { display: block; font-size: 20px; font-weight: bold; margin-top: 5px; opacity: 0.8; }

        /* Cards Grid */
        .cards { display: flex; justify-content: space-between; margin-top: 10px; }
        .card { width: 32%; border: 3px solid #000; border-radius: 14px; padding: 10px; height: 230px; }
        .cardtitle { font-size: 18px; font-weight: 900; border-bottom: 2px solid #000; padding-bottom: 5px; margin-bottom: 5px; }
        
        /* Key-Value Tables inside Cards */
        .kvtable { width: 100%; font-size: 16px; font-weight: 700; }
        .kvtable td { padding: 4px 0; }
        .k { opacity: 0.8; }
        .v { text-align: right; font-weight: 900; }

        /* Forecast Section */
        .forecastCard { margin-top: 15px; border: 3px solid #000; border-radius: 14px; padding: 10px; }
        .forecastTitle { font-size: 18px; font-weight: 900; border-bottom: 2px solid #000; padding-bottom: 5px; margin-bottom: 5px; }
        table.forecast { width: 100%; font-size: 18px; font-weight: 700; border-collapse: collapse; }
        table.forecast td { padding: 5px 0; border-bottom: 1px solid #ccc; }
        table.forecast tr:last-child td { border-bottom: none; }

        /* Footer */
        .status { margin-top: 15px; font-size: 14px; text-align: center; color: #555; }
    </style>
</head>
<body>

    <div class="wrap">
        <div class="topbar">
            <div class="city" id="city">LOADING...</div>
            <div class="clock" id="clock">--:--</div>
        </div>

        <div class="bigrow">
            <div class="tempblock"><span class="temp" id="temp">--</span></div>
            <div class="condblock">
                <span class="cond" id="cond">--</span>
                <span class="aqi" id="aqi">AQI --</span>
                <span class="feels" id="feels">‡§Æ‡§π‡§∏‡•Ç‡§∏ --¬∞</span>
            </div>
        </div>

        <div class="cards">
            <div class="card">
                <div class="cardtitle">‚ìò ‡§Ü‡§ú</div>
                <table class="kvtable">
                    <tr><td class="k">‡§Ü‡§∞‡•ç‡§¶‡•ç‡§∞‡§§‡§æ</td><td class="v" id="hum">--%</td></tr>
                    <tr><td class="k">‡§¨‡§æ‡§∞‡§ø‡§∂</td><td class="v" id="rain">--mm</td></tr>
                    <tr><td class="k">UV</td><td class="v" id="uv">--</td></tr>
                    <tr><td class="k">‡§¶‡•É‡§∂‡•ç‡§Ø‡§§‡§æ</td><td class="v" id="vis">--km</td></tr>
                </table>
            </div>

            <div class="card">
                <div class="cardtitle">„Ä∞ ‡§π‡§µ‡§æ</div>
                <table class="kvtable">
                    <tr><td class="k">‡§ó‡§§‡§ø</td><td class="v" id="wspd">--</td></tr>
                    <tr><td class="k">‡§ù‡•ã‡§Ç‡§ï‡•á</td><td class="v" id="wgust">--</td></tr>
                    <tr><td class="k">‡§¶‡§ø‡§∂‡§æ</td><td class="v" id="wdeg">--</td></tr>
                    <tr><td class="k">‡§∏‡•Å‡§à</td><td class="v" id="wdir">--</td></tr>
                </table>
            </div>

            <div class="card">
                <div class="cardtitle">‚òº ‡§∏‡•Ç‡§∞‡•ç‡§Ø/‡§ö‡§Ç‡§¶‡•ç‡§∞</div>
                <table class="kvtable">
                    <tr><td class="k">‡§â‡§¶‡§Ø</td><td class="v" id="sunrise">--</td></tr>
                    <tr><td class="k">‡§Ö‡§∏‡•ç‡§§</td><td class="v" id="sunset">--</td></tr>
                    <tr><td class="k">‡§ö‡§Ç‡§¶‡•ç‡§∞‡§Æ‡§æ</td><td class="v" id="moonphase">--</td></tr>
                    <tr><td class="k">‡§∞‡•ã‡§∂‡§®‡•Ä</td><td class="v" id="moonillum">--</td></tr>
                </table>
            </div>
        </div>

        <div class="forecastCard">
            <div class="forecastTitle">üìÖ ‡§Ü‡§ó‡§æ‡§Æ‡•Ä ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§®</div>
            <table class="forecast">
                <tbody id="forecastRows">
                    <tr><td>‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="status" id="footerMsg">Last Update: --:--</div>
    </div>

    <script>
        // 1. Helper Functions
        function pad2(n){ return (n<10?"0":"")+n; }
        function fmtHM(d){ return pad2(d.getHours())+":"+pad2(d.getMinutes()); }
        function degToCompass(deg){
            var dirs=["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"];
            var d=((deg%360)+360)%360;
            return dirs[Math.round(d/22.5)%16];
        }

        // 2. Main Render Function
        function renderWeather(j) {
            if(!j || !j.current) return;

            var loc = j.location || {};
            var cur = j.current || {};
            var f = j.forecast || {};
            var f0 = (f.forecastday && f.forecastday[0]) ? f.forecastday[0] : {};
            var astro = f0.astro || {};

            // Header
            document.getElementById("city").innerHTML = loc.name;
            document.getElementById("clock").innerHTML = loc.localtime.split(" ")[1];

            // Main Temp
            document.getElementById("temp").innerHTML = Math.round(cur.temp_c) + "¬∞";
            document.getElementById("cond").innerHTML = cur.condition.text;
            document.getElementById("feels").innerHTML = "‡§Æ‡§π‡§∏‡•Ç‡§∏: " + Math.round(cur.feelslike_c) + "¬∞";
            
            // AQI (Handle missing data safely)
            var aqiVal = (cur.air_quality && cur.air_quality["us-epa-index"]) || "--";
            document.getElementById("aqi").innerHTML = "AQI " + aqiVal;

            // Details
            document.getElementById("hum").innerHTML = cur.humidity + "%";
            document.getElementById("rain").innerHTML = (cur.precip_mm || 0) + "mm";
            document.getElementById("uv").innerHTML = cur.uv;
            document.getElementById("vis").innerHTML = cur.vis_km + "km";

            // Wind
            document.getElementById("wspd").innerHTML = cur.wind_kph + "kph";
            document.getElementById("wgust").innerHTML = cur.gust_kph + "kph";
            document.getElementById("wdeg").innerHTML = cur.wind_degree + "¬∞";
            document.getElementById("wdir").innerHTML = degToCompass(cur.wind_degree);

            // Astro
            document.getElementById("sunrise").innerHTML = astro.sunrise;
            document.getElementById("sunset").innerHTML = astro.sunset;
            document.getElementById("moonphase").innerHTML = astro.moon_phase;
            document.getElementById("moonillum").innerHTML = astro.moon_illumination + "%";

            // Forecast Loop
            var rows = "";
            var daysMap = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"]; // You can change to Hindi if preferred
            
            // Start from index 1 (Tomorrow)
            for(var i=1; i<=2; i++) {
                var dayData = f.forecastday[i];
                if(dayData) {
                    var dateObj = new Date(dayData.date);
                    var dayName = daysMap[dateObj.getDay()];
                    var min = Math.round(dayData.day.mintemp_c);
                    var max = Math.round(dayData.day.maxtemp_c);
                    var txt = dayData.day.condition.text;
                    rows += `<tr>
                        <td style="width:15%">${dayName}</td>
                        <td style="width:20%"><b>${max}¬∞</b> / ${min}¬∞</td>
                        <td>${txt}</td>
                    </tr>`;
                }
            }
            document.getElementById("forecastRows").innerHTML = rows;
            document.getElementById("footerMsg").innerHTML = "Updated: " + loc.localtime;
        }

        // 3. Auto-Start Logic
        document.addEventListener("DOMContentLoaded", () => {
            if (window.injectedData) {
                renderWeather(window.injectedData);
            } else {
                console.log("No Data found. Rendering Dummy Data for preview.");
                // Dummy data for testing on PC
                renderWeather({
                    location: { name: "Mumbai (Preview)", localtime: "2026-01-19 14:30" },
                    current: { 
                        temp_c: 28, condition: {text: "Smoke"}, feelslike_c: 32, humidity: 60, 
                        wind_kph: 15, gust_kph: 20, wind_degree: 180, vis_km: 4, uv: 5
                    },
                    forecast: {
                        forecastday: [
                            { astro: { sunrise: "07:15 AM", sunset: "06:20 PM", moon_phase: "Waxing", moon_illumination: 45 } },
                            { date: "2026-01-20", day: { maxtemp_c: 30, mintemp_c: 22, condition: {text: "Sunny"} } },
                            { date: "2026-01-21", day: { maxtemp_c: 29, mintemp_c: 21, condition: {text: "Clear"} } }
                        ]
                    }
                });
            }
        });
    </script>
</body>
</html>
