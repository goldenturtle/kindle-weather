<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="utf-8">
    <title>Kindle Weather Classic</title>
    <style>
        * { box-sizing: border-box; }
        body {
            margin: 0; padding: 0;
            background-color: white; color: black;
            width: 758px; height: 1024px;
            overflow: hidden;
            font-family: "Noto Sans Devanagari", "Lohit Devanagari", "Arial Unicode MS", sans-serif;
            display: flex; flex-direction: column;
        }

        /* 1. HEADER (Restored Layout) */
        .header {
            background-color: black; color: white;
            height: 90px; /* Taller to fit Date + Tithi */
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 25px;
        }
        .city { font-size: 36px; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; }
        
        .header-right { 
            text-align: right; display: flex; flex-direction: column; justify-content: center; 
        }
        .date { font-size: 26px; font-weight: 900; margin-bottom: 4px; }
        .tithi { font-size: 20px; font-weight: 700; color: #ddd; }

        /* 2. HERO (Clean, No Graphics) */
        .hero {
            display: flex; align-items: center;
            padding: 20px 25px;
            border-bottom: 3px solid black;
            height: 240px;
        }
        .hero-left { width: 45%; }
        .main-temp { font-size: 140px; font-weight: 900; line-height: 1; letter-spacing: -6px; }
        
        .hero-right { width: 55%; padding-left: 20px; display: flex; flex-direction: column; justify-content: center; }
        .main-cond { font-size: 42px; font-weight: 900; margin-bottom: 10px; line-height: 1.1; }
        .summary { font-size: 22px; font-weight: 700; opacity: 0.8; line-height: 1.4; margin-bottom: 15px;}
        
        .aqi-box { 
            display: inline-block; 
            border: 3px solid black; 
            color: black; 
            padding: 5px 12px; 
            border-radius: 8px; 
            font-size: 20px; 
            font-weight: 900; 
            width: fit-content;
        }

        /* 3. HOURLY STRIP */
        .hourly-title { font-size: 22px; font-weight: 900; padding: 15px 25px 0; opacity: 0.7; text-transform: uppercase; }
        .hourly-container {
            display: flex; justify-content: space-between;
            padding: 10px 25px 20px;
            border-bottom: 3px solid black;
        }
        .hour-box {
            width: 23%; text-align: center;
            background: #f0f0f0; border-radius: 10px; padding: 10px 5px;
        }
        .h-time { font-size: 24px; font-weight: 900; margin-bottom: 5px; }
        .h-temp { font-size: 40px; font-weight: 900; line-height: 1.1; }
        .h-cond { font-size: 22px; margin: 5px 0; font-weight: 700; height: 50px; display: flex; align-items: center; justify-content: center; line-height: 1; }
        .h-rain { font-size: 20px; font-weight: 900; color: #444; }

        /* 4. DETAILS GRID */
        .grid-container {
            display: grid; grid-template-columns: 1fr 1fr; gap: 20px;
            padding: 20px 25px; 
            flex-grow: 1; 
        }
        .detail-box {
            border: 3px solid black; border-radius: 12px; padding: 10px 20px;
            display: flex; flex-direction: column; justify-content: space-evenly;
        }
        .d-title { font-size: 22px; font-weight: 900; border-bottom: 2px solid black; margin-bottom: 8px; padding-bottom: 4px; }
        .d-row { display: flex; justify-content: space-between; font-size: 26px; font-weight: 700; margin-bottom: 4px; }

        /* 5. FORECAST */
        .forecast-container { padding: 10px 25px; border-top: 2px solid black; }
        .f-row {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #ccc; padding: 8px 0;
            font-size: 26px; font-weight: 700;
        }
        .f-row:last-child { border-bottom: none; }
        
        /* 6. ASTRO STRIP */
        .astro-strip {
            background: black; color: white;
            padding: 15px 25px;
            display: flex; justify-content: space-between;
            font-size: 24px; font-weight: 900; align-items: center;
        }
        .astro-group { display: flex; align-items: center; gap: 15px; }

        /* FOOTER */
        .footer { text-align: center; font-size: 14px; color: #666; background: #eee; padding: 4px; }

    </style>
</head>
<body>

    <div class="header">
        <div class="city" id="city">MUMBAI</div>
        <div class="header-right">
            <div class="date" id="date">--</div>
            <div class="tithi" id="tithi">--</div>
        </div>
    </div>

    <div class="hero">
        <div class="hero-left">
            <div class="main-temp" id="temp">--</div>
        </div>
        <div class="hero-right">
            <div class="main-cond" id="cond">--</div>
            <div class="summary" id="summary">...</div>
            <div class="aqi-box" id="aqi">AQI --</div>
        </div>
    </div>

    <div class="hourly-title">‡§Ö‡§ó‡§≤‡•á 12 ‡§ò‡§Ç‡§ü‡•á</div>
    <div class="hourly-container" id="hourlyStrip"></div>

    <div class="grid-container">
        <div class="detail-box">
            <div class="d-title">‡§π‡§µ‡§æ ‡§î‡§∞ ‡§¨‡§æ‡§∞‡§ø‡§∂</div>
            <div class="d-row"><span>‡§π‡§µ‡§æ</span><span id="wind">--</span></div>
            <div class="d-row"><span>‡§ù‡•ã‡§Ç‡§ï‡•á</span><span id="gust">--</span></div>
            <div class="d-row"><span>‡§¨‡§æ‡§∞‡§ø‡§∂</span><span id="rain">--</span></div>
        </div>
        <div class="detail-box">
            <div class="d-title">‡§µ‡§æ‡§§‡§æ‡§µ‡§∞‡§£</div>
            <div class="d-row"><span>‡§Ü‡§∞‡•ç‡§¶‡•ç‡§∞‡§§‡§æ</span><span id="hum">--</span></div>
            <div class="d-row"><span>‡§¶‡•É‡§∂‡•ç‡§Ø‡§§‡§æ</span><span id="vis">--</span></div>
            <div class="d-row"><span>UV</span><span id="uv">--</span></div>
        </div>
    </div>

    <div class="forecast-container" id="forecastRows"></div>

    <div class="astro-strip">
        <div class="astro-group"><span id="sun-times">‚òÄÔ∏è --</span></div>
        <div class="astro-group"><span id="moon-times">üåô --</span></div>
    </div>

    <div class="footer" id="footerMsg">Updated: --</div>

    <script>
        // === HINDI CONSTANTS ===
        const DAYS_HI = ["‡§∞‡§µ‡§ø‡§µ‡§æ‡§∞", "‡§∏‡•ã‡§Æ‡§µ‡§æ‡§∞", "‡§Æ‡§Ç‡§ó‡§≤‡§µ‡§æ‡§∞", "‡§¨‡•Å‡§ß‡§µ‡§æ‡§∞", "‡§ó‡•Å‡§∞‡•Å‡§µ‡§æ‡§∞", "‡§∂‡•Å‡§ï‡•ç‡§∞‡§µ‡§æ‡§∞", "‡§∂‡§®‡§ø‡§µ‡§æ‡§∞"];
        const MONTHS_HI = ["‡§ú‡§®‡§µ‡§∞‡•Ä", "‡§´‡§∞‡§µ‡§∞‡•Ä", "‡§Æ‡§æ‡§∞‡•ç‡§ö", "‡§Ö‡§™‡•ç‡§∞‡•à‡§≤", "‡§Æ‡§à", "‡§ú‡•Ç‡§®", "‡§ú‡•Å‡§≤‡§æ‡§à", "‡§Ö‡§ó‡§∏‡•ç‡§§", "‡§∏‡§ø‡§§‡§Ç‡§¨‡§∞", "‡§Ö‡§ï‡•ç‡§ü‡•Ç‡§¨‡§∞", "‡§®‡§µ‡§Ç‡§¨‡§∞", "‡§¶‡§ø‡§∏‡§Ç‡§¨‡§∞"];
        
        // === WEATHER TRANSLATIONS ===
        const WEATHER_MAP = { "Sunny": "‡§ñ‡§ø‡§≤‡•Ä ‡§ß‡•Ç‡§™", "Clear": "‡§∏‡§æ‡§´‡§º", "Partly cloudy": "‡§Ü‡§Ç‡§∂‡§ø‡§ï ‡§¨‡§æ‡§¶‡§≤", "Cloudy": "‡§¨‡§æ‡§¶‡§≤", "Overcast": "‡§ò‡§®‡•á ‡§¨‡§æ‡§¶‡§≤", "Mist": "‡§ï‡•ã‡§π‡§∞‡§æ", "Rain": "‡§¨‡§æ‡§∞‡§ø‡§∂", "Drizzle": "‡§¨‡•Ç‡§Ç‡§¶‡§æ‡§¨‡§æ‡§Ç‡§¶‡•Ä", "Thunder": "‡§§‡•Ç‡§´‡§æ‡§®", "Smoke": "‡§ß‡•Å‡§Ü‡§Ç", "Haze": "‡§ß‡•Å‡§Ç‡§ß" };

        function translate(text) {
            for (let k in WEATHER_MAP) { if (text.includes(k)) return WEATHER_MAP[k]; }
            return text;
        }

        // === REAL INDIAN AQI CALCULATOR ===
        // Maps Raw PM2.5 to Indian AQI Scale (Approximate)
        function calculateAQI(pm25) {
            if (!pm25) return "--";
            let aqi = 0;
            // Formula based on CPCB Breakpoints
            if (pm25 <= 30) aqi = pm25 * (50/30);
            else if (pm25 <= 60) aqi = 50 + (pm25-30) * (50/30);
            else if (pm25 <= 90) aqi = 100 + (pm25-60) * (100/30);
            else if (pm25 <= 120) aqi = 200 + (pm25-90) * (100/30);
            else if (pm25 <= 250) aqi = 300 + (pm25-120) * (100/130);
            else aqi = 400 + (pm25-250) * (100/130);
            
            return Math.round(aqi);
        }

        function getTithi(date) {
            const knownNewMoon = new Date('2000-01-06T18:14:00Z');
            const diff = (date - knownNewMoon) / (1000 * 60 * 60 * 24);
            const age = diff % 29.53;
            const idx = Math.floor((age / 29.53) * 30) + 1;
            const paksha = idx <= 15 ? "‡§∂‡•Å‡§ï‡•ç‡§≤" : "‡§ï‡•É‡§∑‡•ç‡§£";
            return `${idx <= 15 ? 'üåï' : 'üåë'} ${paksha} ‡§™‡§ï‡•ç‡§∑`;
        }

        function render(data) {
            if(!data || !data.current) return;
            const cur = data.current;
            const loc = data.location;
            const f = data.forecast.forecastday;
            const today = f[0];
            const now = new Date(loc.localtime);

            // 1. Header
            document.getElementById("city").innerText = loc.name;
            document.getElementById("date").innerText = `${DAYS_HI[now.getDay()]}, ${now.getDate()} ${MONTHS_HI[now.getMonth()]}`;
            document.getElementById("tithi").innerText = getTithi(now);

            // 2. Hero
            document.getElementById("temp").innerText = Math.round(cur.temp_c) + "¬∞";
            document.getElementById("cond").innerText = translate(cur.condition.text);
            document.getElementById("summary").innerText = `‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ${Math.round(today.day.maxtemp_c)}¬∞ ‚Ä¢ ‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ ${Math.round(today.day.mintemp_c)}¬∞ ‚Ä¢ ‡§¨‡§æ‡§∞‡§ø‡§∂ ${today.day.daily_chance_of_rain}%`;
            
            // AQI CALCULATION
            // We use PM2.5 from API if available to show "Real" AQI
            const pm25 = cur.air_quality ? cur.air_quality.pm2_5 : 0;
            const realAQI = calculateAQI(pm25);
            document.getElementById("aqi").innerText = `AQI ${realAQI}`;

            // 3. Hourly
            let allHours = [...today.hour, ...f[1].hour];
            const currentEpoch = cur.last_updated_epoch;
            let currentIndex = allHours.findIndex(h => h.time_epoch > currentEpoch);
            if(currentIndex === -1) currentIndex = 0;

            let hourlyHTML = "";
            [3, 6, 9, 12].forEach(offset => {
                const h = allHours[currentIndex + offset];
                if(h) {
                    const dateObj = new Date(h.time);
                    let hrs = dateObj.getHours();
                    const ampm = hrs >= 12 ? 'PM' : 'AM';
                    hrs = hrs % 12; hrs = hrs ? hrs : 12;
                    hourlyHTML += `
                    <div class="hour-box">
                        <div class="h-time">${hrs} ${ampm}</div>
                        <div class="h-temp">${Math.round(h.temp_c)}¬∞</div>
                        <div class="h-cond">${translate(h.condition.text)}</div>
                        <div class="h-rain">üíß ${h.chance_of_rain}%</div>
                    </div>`;
                }
            });
            document.getElementById("hourlyStrip").innerHTML = hourlyHTML;

            // 4. Details
            document.getElementById("wind").innerText = cur.wind_kph + " km";
            document.getElementById("gust").innerText = cur.gust_kph + " km";
            document.getElementById("rain").innerText = (cur.precip_mm || 0) + " mm";
            document.getElementById("hum").innerText = cur.humidity + "%";
            document.getElementById("vis").innerText = cur.vis_km + " km";
            document.getElementById("uv").innerText = cur.uv;

            // 5. Forecast
            let forecastHTML = "";
            for(let i=1; i<=2; i++) {
                const day = f[i];
                const dName = DAYS_HI[new Date(day.date).getDay()];
                forecastHTML += `
                <div class="f-row">
                    <div style="width:25%">${dName}</div>
                    <div style="width:35%">${translate(day.day.condition.text)}</div>
                    <div style="width:40%; text-align:right;">
                        ‚¨Ü${Math.round(day.day.maxtemp_c)}¬∞ ‚¨á${Math.round(day.day.mintemp_c)}¬∞
                    </div>
                </div>`;
            }
            document.getElementById("forecastRows").innerHTML = forecastHTML;

            // 6. Astro
            document.getElementById("sun-times").innerText = `‚òÄÔ∏è ${today.astro.sunrise} - ${today.astro.sunset}`;
            document.getElementById("moon-times").innerText = `üåô ${today.astro.moonrise} - ${today.astro.moonset}`;

            document.getElementById("footerMsg").innerText = "Updated: " + loc.localtime.split(" ")[1];
        }

        document.addEventListener("DOMContentLoaded", () => {
            if (window.injectedData) render(window.injectedData);
        });
    </script>
</body>
</html>
